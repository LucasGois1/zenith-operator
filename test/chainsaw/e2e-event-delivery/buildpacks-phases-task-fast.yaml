apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: buildpacks-phases
spec:
  params:
    - name: APP_IMAGE
      type: string
    - name: SOURCE_SUBPATH
      type: string
      default: ""
    - name: CNB_BUILDER_IMAGE
      type: string
      default: "paketobuildpacks/builder-jammy-base:latest"
    - name: CNB_PROCESS_TYPE
      type: string
      default: ""
  workspaces:
    - name: source
  results:
    - name: APP_IMAGE_DIGEST
      description: Digest of the image (fast-path for testing operator behavior)
  steps:
    - name: copy-image
      image: gcr.io/go-containerregistry/crane:latest
      args:
        - cp
        - --insecure
        - docker.io/library/busybox:1.36
        - $(params.APP_IMAGE)
    - name: get-digest
      image: gcr.io/go-containerregistry/crane:latest
      args:
        - digest
        - --insecure
        - $(params.APP_IMAGE)
      stdout: $(results.APP_IMAGE_DIGEST.path)
